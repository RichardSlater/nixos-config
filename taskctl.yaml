tasks:
  rebuild:molasses:
    command: nixos-rebuild -I nixos-config=/home/richardsl/nixos/src/molasses-wsl/configuration.nix switch
  rebuild:brix0001:
    command: nixos-rebuild -I nixos-config=/home/richardsl/nixos/src/brix0001/configuration.nix switch

  restart:whoami:
    command: systemctl restart podman-whoami.service
  restart:reverse-proxy:
    command: systemctl restart podman-reverse-proxy.service

  watch:reverse-proxy:
    command: journalctl -u podman-reverse-proxy.service -f

pipelines:
  run:molasses:
    - task: rebuild:molasses
    - task: restart:whoami
      depends_on: rebuild:molasses
    - task: restart:reverse-proxy
      depends_on: rebuild:molasses
  run:brix0001:
    - task: rebuild:brix0001
    - task: restart:whoami
      depends_on: rebuild:brix0001
    - task: restart:reverse-proxy
      depends_on: rebuild:brix0001